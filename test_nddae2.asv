% F = { @(t,X,Xt)[
%                     X(4)-X(1)
%                     X(3)*(X(4)-X(1))+Xt(2)
%     ];@(t,X,Xt)[
%                     X(6)-X(3)
%                     X(5)*(X(4)-X(1))+X(3)*(X(6)-X(3))+Xt(4)
%     ]};
% 
% Phi = {@(t)[sin(t),cos(t)],@(t)[cos(t),-sin(t)]};

P=rand(2);
Q=rand(2);

E= P*[
    1   0   
    0   0   
    ]*Q;
A= P*[
    0   0  
    1   0  
    ]*Q;
B= P*[
    0   1   
    0   1   
    ]*Q;

f=@(t)  E*[ 1; cos(t)] - A*[t;sin(t)] - B*[t-tau;sin(t-tau)];
df=@(t) E*[ 0;-sin(t)] - A*[1;cos(t)] - B*[1;cos(t-tau)];


F = { @(t,X,Xt) -E*x(3:4)+A*x(1:2)+B*Xt(1:2)+f(t),
      @(t,X,Xt) -E*x(5:6)+A*x(2:4)+B*Xt(3:4)+df(t)
      };


Phi = {@(t)[t,sin(t)],@(t)[1,cos(t)]};

tau=1;

% the exact solution
xe = @(t)[t;sin(t)];
xed = @(t)[1; cos(t)];




tau = 1;
tspan = [0,10];

options.StrIdx = 1;
options.Shift = 1;

[t,x] = solve_nddae2(F,Phi,tau,tspan,2,options);
